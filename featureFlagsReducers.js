"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.useFeatureFlagged=exports.useIsFeatureActive=exports.reducerFeatureFlags=exports.resetFeaturesRedux=exports.editFeatureRedux=exports.loadFeatureFlagsRedux=void 0;var react_redux_1=require("react-redux");var immer_1=__importDefault(require("immer"));var featureFlags_1=require("./featureFlags");var FEATURE_FLAGS_ADD="featureFlagsAdd";var FEATURE_FLAG_EDIT="featureFlagsEdit";var FEATURE_FLAGS_RESET="featureFlagsReset";var loadFeatureFlagsRedux=function(_a){var features=_a.features,_b=_a.overrides,overrides=_b===void 0?[]:_b,_c=_a.persist,persist=_c===void 0?false:_c,reset=_a.reset;return{type:FEATURE_FLAGS_ADD,payload:{features:features,overrides:overrides,persist:persist,reset:reset}}};exports.loadFeatureFlagsRedux=loadFeatureFlagsRedux;var editFeatureRedux=function(payload){return{type:FEATURE_FLAG_EDIT,payload:payload}};exports.editFeatureRedux=editFeatureRedux;var resetFeaturesRedux=function(){return{type:FEATURE_FLAGS_RESET}};exports.resetFeaturesRedux=resetFeaturesRedux;var initialState={features:[],persist:false};exports.reducerFeatureFlags=(0,immer_1.default)(function(state,action){if(!state){return initialState}switch(action.type){case FEATURE_FLAGS_ADD:{var _a=action.payload,features=_a.features,overrides=_a.overrides,persist=_a.persist,reset=_a.reset;var newFeatures_1=reset||!persist?[]:__spreadArray([],state.features,true);(0,featureFlags_1.featuresWithOverrides)(features,overrides).forEach(function(feature){var featureIndex=newFeatures_1.findIndex(function(f){return f.id===feature.id});if(featureIndex===-1){newFeatures_1.push(__assign(__assign({},feature),{active:feature.active||false,original:feature.original!==undefined?feature.original:feature.active||false}))}else{newFeatures_1[featureIndex].original=feature.active||false}});state.persist=action.payload.persist;state.features=newFeatures_1;break}case FEATURE_FLAG_EDIT:{var newFeatures=__spreadArray([],state.features,true);var featureIndex=newFeatures.findIndex(function(flag){return flag.id===action.payload.id});newFeatures[featureIndex].active=action.payload.active;state.features=newFeatures;break}case FEATURE_FLAGS_RESET:{var features=__spreadArray([],state.features,true);var newFeatures=features.map(function(feature){return __assign(__assign({},feature),{active:feature.original})});state.features=newFeatures;break}default:{break}}});exports.default=exports.reducerFeatureFlags;var useIsFeatureActive=function(flag,reduxKey){var _a;if(reduxKey===void 0){reduxKey="FeatureFlags"}return((_a=(0,react_redux_1.useSelector)(function(state){return state[reduxKey].features}).find(function(feature){return feature.id===flag}))===null||_a===void 0?void 0:_a.active)||false};exports.useIsFeatureActive=useIsFeatureActive;var useFeatureFlagged=function(flag,activeItem,fallback,reduxKey){if(fallback===void 0){fallback=null}if(reduxKey===void 0){reduxKey=undefined}return(0,exports.useIsFeatureActive)(flag,reduxKey)?activeItem:fallback};exports.useFeatureFlagged=useFeatureFlagged;