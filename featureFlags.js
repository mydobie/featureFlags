"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.getResetFeatureFlags=exports.loadFeatureFlags=exports.useLocalStorage=exports.featureFlagged=exports.isFeatureActive=exports.editFeatureFlag=exports.getPersistRedux=exports.getFeatureFlagsRedux=exports.featuresWithOverrides=exports.FEATURE_FLAGS_PERSIST=exports.FEATURE_FLAGS=void 0;var react_1=__importDefault(require("react"));exports.FEATURE_FLAGS="featureFlags";exports.FEATURE_FLAGS_PERSIST="featuresFlagsPersist";var featuresWithOverrides=function(featuresArray,overRidesArray){if(featuresArray===void 0){featuresArray=[]}if(overRidesArray===void 0){overRidesArray=[]}var features=Array.from(featuresArray);overRidesArray.forEach(function(flag){var featureIndex=features.findIndex(function(feature){return feature.id===flag.id});if(featureIndex===-1){features.push({id:flag.id,active:flag.active,description:flag.description})}else{features[featureIndex].active=flag.active}});return features};exports.featuresWithOverrides=featuresWithOverrides;var getFeatureFlags=function(){var _a;var features=JSON.parse((_a=localStorage.getItem(exports.FEATURE_FLAGS))!==null&&_a!==void 0?_a:"[]");return features};var getFeatureFlagsRedux=function(state){return state.FeatureFlags.features};exports.getFeatureFlagsRedux=getFeatureFlagsRedux;var getPersistRedux=function(state){return state.FeatureFlags.persist};exports.getPersistRedux=getPersistRedux;var addFeatureFlag=function(id,active,description){var _a;if(description===void 0){description=""}var features=JSON.parse((_a=localStorage.getItem(exports.FEATURE_FLAGS))!==null&&_a!==void 0?_a:"[]");var featureIndex=features.findIndex(function(flag){return flag.id===id});if(featureIndex===-1){features.push({id:id,active:active,description:description,original:active})}else{features[featureIndex].original=active}localStorage.setItem(exports.FEATURE_FLAGS,JSON.stringify(features))};var editFeatureFlag=function(id,active){var _a;var features=JSON.parse((_a=localStorage.getItem(exports.FEATURE_FLAGS))!==null&&_a!==void 0?_a:"[]");var featureIndex=features.findIndex(function(flag){return flag.id===id});features[featureIndex].active=active;return localStorage.setItem(exports.FEATURE_FLAGS,JSON.stringify(features))};exports.editFeatureFlag=editFeatureFlag;var isFeatureActive=function(flag,reduxState,reduxKey){var _a,_b;if(reduxState===void 0){reduxState=undefined}if(reduxKey===void 0){reduxKey="FeatureFlags"}if(reduxState!==undefined){return(_a=reduxState[reduxKey].features.find(function(feature){return feature.id===flag}))===null||_a===void 0?void 0:_a.active}return((_b=getFeatureFlags().find(function(feature){return feature.id===flag}))===null||_b===void 0?void 0:_b.active)||false};exports.isFeatureActive=isFeatureActive;var featureFlagged=function(flag,activeItem,fallback,reduxState,reduxKey){if(fallback===void 0){fallback=null}if(reduxState===void 0){reduxState=undefined}if(reduxKey===void 0){reduxKey=undefined}return(0,exports.isFeatureActive)(flag,reduxState,reduxKey)?activeItem:fallback};exports.featureFlagged=featureFlagged;var useLocalStorage=function(type,initialValue){if(initialValue===void 0){initialValue=undefined}var key=type;var _a=react_1.default.useState(function(){try{var item=window.localStorage.getItem(key);return item?JSON.parse(item):initialValue}catch(error){console.log(error);return initialValue}}),storedValue=_a[0],setStoredValue=_a[1];var setValue=function(value){try{var valueToStore=value instanceof Function?value(storedValue):value;setStoredValue(valueToStore);window.localStorage.setItem(key,JSON.stringify(valueToStore))}catch(error){console.log(error)}};return[storedValue,setValue]};exports.useLocalStorage=useLocalStorage;var loadFeatureFlags=function(_a){var features=_a.features,persist=_a.persist,overrides=_a.overrides;if(!persist){localStorage.setItem(exports.FEATURE_FLAGS,JSON.stringify([]))}localStorage.setItem(exports.FEATURE_FLAGS_PERSIST,persist?"true":"false");(0,exports.featuresWithOverrides)(features||[],overrides||[]).forEach(function(feature){addFeatureFlag(feature.id,feature.active,feature.description)});return features};exports.loadFeatureFlags=loadFeatureFlags;var getResetFeatureFlags=function(){var features=getFeatureFlags();var newFeatures=features.map(function(feature){return __assign(__assign({},feature),{active:feature.original||false})});return newFeatures};exports.getResetFeatureFlags=getResetFeatureFlags;